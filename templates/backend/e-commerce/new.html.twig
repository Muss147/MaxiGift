{% extends "backend/layout.html.twig" %}

{% block title %}{% if product.sku %}Modifier l'article{% else %}Ajouter un article{% endif %}{% endblock %}
{% block description %}{% endblock %}

{% block stylesheets %}
<!--begin::Page Vendor Stylesheets(used by this page)-->
<link href="{{asset('assets/plugins/custom/datatables/datatables.bundle.css')}}" rel="stylesheet" type="text/css" />
<!--end::Page Vendor Stylesheets-->

<style type="text/css">
.dz-image img {
    width: 120px;
    height: auto;
    object-fit: cover;
}
</style>
{% endblock %}

{% block pageTitle %}
<div class="page-title d-flex flex-column align-items-start justify-content-center flex-wrap me-lg-2 pb-2 pb-lg-0" data-kt-swapper="true" data-kt-swapper-mode="prepend" data-kt-swapper-parent="{default: '#kt_content_container', lg: '#kt_header_container'}">
    <!--begin::Heading-->
    <h1 class="text-dark fw-bolder my-1 fs-2">{% if product.sku %}Modifier l'article{% else %}Ajouter un article{% endif %} 
    <small class="text-muted fs-6 fw-normal ms-1"></small></h1>
    <!--end::Heading-->
    <!--begin::Breadcrumb-->
    <ul class="breadcrumb fw-bold fs-base my-1">
        <li class="breadcrumb-item text-muted">
            <a href="{{path('dash')}}" class="text-muted">Dashboards</a>
        </li>
        <li class="breadcrumb-item text-muted">E-Commerce</li>
        <li class="breadcrumb-item text-dark"><a href="{{path('products.list')}}" class="text-muted">Liste des Produits</a></li>
        <li class="breadcrumb-item text-dark">{% if product.sku %}Modifier l'article{% else %}Ajouter un article{% endif %}</li>
    </ul>
    <!--end::Breadcrumb-->
</div>
{% endblock %}

{% block secondaryMenu %}
<!--begin::Secondary-->
<div class="aside-secondary d-flex flex-row-fluid">
    <div class="aside-workspace overflow-auto my-2 my-lg-7 px-2 px-lg-4" id="kt_aside_wordspace">
        <div class="menu menu-sub-indention menu-rounded menu-column menu-active-bg menu-title-gray-600 menu-icon-gray-400 menu-state-primary menu-arrow-gray-500 fw-semibold fs-6 my-5 mt-lg-2 mb-lg-0" id="kt_aside_menu" data-kt-menu="true">
            <div id="kt_aside_menu_wrapper" class="hover-scroll-y me-lg-n4 pe-lg-4" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-height="auto" data-kt-scroll-offset="20px" data-kt-scroll-wrappers="#kt_aside_wordspace">
                <div class="menu-item">
                    <div class="menu-content">
                        <span class="menu-section fs-5 fw-bold ps-1 py-1">E-Commerce</span>
                    </div>
                </div>
                <div class="menu-item">
                    <span class="menu-link">
                        <span class="menu-bullet">
                            <span class="bullet bullet-dot"></span>
                        </span>
                        <a href="{{path('products.list')}}" class="menu-title">Liste des Articles</a>
                    </span>
                </div>
                <div class="menu-item here show">
                    <span class="menu-link">
                        <span class="menu-bullet">
                            <span class="bullet bullet-dot"></span>
                        </span>
                        <a href="{{path('products.new')}}" class="menu-title">Ajouter un Article</a>
                    </span>
                </div>
                <div class="menu-item">
                    <span class="menu-link">
                        <span class="menu-bullet">
                            <span class="bullet bullet-dot"></span>
                        </span>
                        <a href="#" class="menu-title">Bons Plans</a>
                        <span class="menu-arrow"></span>
                    </span>
                    <div class="menu-sub menu-sub-accordion" kt-hidden-height="250" style="display: none; overflow: hidden;">
                        <div class="menu-item">
                            <a class="menu-link active" href="#">
                                <span class="menu-bullet">
                                    <span class="bullet bullet-dot"></span>
                                </span>
                                <span class="menu-title">Tous les bons plans</span>
                            </a>
                        </div>
                        <div class="menu-item">
                            <a class="menu-link active" href="#">
                                <span class="menu-bullet">
                                    <span class="bullet bullet-dot"></span>
                                </span>
                                <span class="menu-title">Types de bons plans</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="menu-item">
                    <span class="menu-link">
                        <span class="menu-bullet">
                            <span class="bullet bullet-dot"></span>
                        </span>
                        <a href="#" class="menu-title">Categories</a>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
<!--end::Secondary-->
{% endblock %}

{% block body %}
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <!--begin::Container-->
    <div class="container-xxl" id="kt_content_container">
        <!--begin::Form-->
        <form id="kt_ecommerce_add_product_form" class="form d-flex flex-column flex-lg-row" data-kt-redirect="" action="" method="POST" enctype="multipart/form-data">
            <!--begin::Aside column-->
            <div class="d-flex flex-column gap-7 gap-lg-10 w-100 w-lg-300px mb-7 me-lg-10">
                <!--begin::Thumbnail settings-->
                <div class="card card-flush py-4">
                    <!--begin::Card header-->
                    <div class="card-header">
                        <!--begin::Card title-->
                        <div class="card-title">
                            <h2>Vignette</h2>
                        </div>
                        <!--end::Card title-->
                    </div>
                    <!--end::Card header-->
                    <!--begin::Card body-->
                    <div class="card-body text-center pt-0">
                        <!--begin::Image input-->
                        <!--begin::Image input placeholder-->
                        <!--end::Image input placeholder-->
                        <div class="image-input image-input-empty image-input-outline image-input-placeholder mb-3" data-kt-image-input="true" style="background-image: url({{asset('assets/media/svg/files/blank-image.svg')}});">
                            <!--begin::Preview existing avatar-->
                            <div class="image-input-wrapper w-150px h-150px"></div>
                            <!--end::Preview existing avatar-->
                            <!--begin::Label-->
                            <label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="change" data-bs-toggle="tooltip" title="Changer de vignette">
                                <i class="bi bi-pencil-fill fs-7"></i>
                                <!--begin::Inputs-->
                                <input type="file" name="cover" accept=".png, .jpg, .jpeg" />
                                <input type="hidden" name="cover_remove" />
                                <!--end::Inputs-->
                            </label>
                            <!--end::Label-->
                            <!--begin::Cancel-->
                            <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="cancel" data-bs-toggle="tooltip" title="Cancel avatar">
                                <i class="bi bi-x fs-2"></i>
                            </span>
                            <!--end::Cancel-->
                            <!--begin::Remove-->
                            <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="remove" data-bs-toggle="tooltip" title="Remove avatar">
                                <i class="bi bi-x fs-2"></i>
                            </span>
                            <!--end::Remove-->
                        </div>
                        <!--end::Image input-->
                        <!--begin::Description-->
                        <div class="text-muted fs-7">Définissez l'image miniature du produit. Seuls les fichiers image *.png, *.jpg et *.jpeg sont acceptés</div>
                        <!--end::Description-->
                    </div>
                    <!--end::Card body-->
                </div>
                <!--end::Thumbnail settings-->
                <!--begin::Status-->
                <div class="card card-flush py-4">
                    <!--begin::Card header-->
                    <div class="card-header">
                        <!--begin::Card title-->
                        <div class="card-title">
                            <h2>Statut</h2>
                        </div>
                        <!--end::Card title-->
                        <!--begin::Card toolbar-->
                        <div class="card-toolbar">
                            <div class="rounded-circle bg-success w-15px h-15px" id="kt_ecommerce_add_product_status"></div>
                        </div>
                        <!--begin::Card toolbar-->
                    </div>
                    <!--end::Card header-->
                    <!--begin::Card body-->
                    <div class="card-body pt-0">
                        <!--begin::Select2-->
                        <select name="status" class="form-select mb-2" data-control="select2" data-hide-search="true" data-placeholder="Select an option" id="kt_ecommerce_add_product_status_select">
                            <option value="Publié" {% if product.status == "Publié" %}selected{% endif %}>Publié</option>
                            <option value="Brouillon" {% if product.status == "Brouillon" %}selected{% endif %}>Brouillon</option>
                            <option value="Programmé" {% if product.status == "Programmé" %}selected{% endif %}>Programmé</option>
                            <option value="Inactif" {% if product.status == "Inactif" %}selected{% endif %}>Inactif</option>
                        </select>
                        <!--end::Select2-->
                        <!--begin::Description-->
                        <div class="text-muted fs-7">Définissez l'état du produit.</div>
                        <!--end::Description-->
                        <!--begin::Datepicker-->
                        <div class="d-none mt-10">
                            <label for="kt_ecommerce_add_product_status_datepicker" class="form-label">Date et heure de publication</label>
                            <input class="form-control" id="kt_ecommerce_add_product_status_datepicker" placeholder="Sélectionnez la date et l'heure" />
                        </div>
                        <!--end::Datepicker-->
                    </div>
                    <!--end::Card body-->
                </div>
                <!--end::Status-->
                <!--begin::Category & tags-->
                <div class="card card-flush py-4">
                    <!--begin::Card header-->
                    <div class="card-header">
                        <!--begin::Card title-->
                        <div class="card-title">
                            <h2>Détails du produit</h2>
                        </div>
                        <!--end::Card title-->
                    </div>
                    <!--end::Card header-->
                    <!--begin::Card body-->
                    <div class="card-body pt-0 fv-row">
                        <!--begin::Input group-->
                        <!--begin::Label-->
                        <label class="required form-label">Catégorie</label>
                        <!--end::Label-->
                        <!--begin::Select2-->
                        <select name="categorie" class="form-select mb-2" data-control="select2" data-hide-search="true" data-placeholder="Selectionner une catégorie">
                            <option></option>
                            {% for parent in categories %}
                            <optgroup label="{{parent.libelle}}">
                                {% for categ in parent.children %}
                                <option value="{{categ.id}}" {% if product.categorie == categ %}selected{% endif %}>{{categ.libelle}}</option>
                                {% endfor %}
                            </optgroup>
                            {% endfor %}
                        </select>
                        <!--end::Select2-->
                        <!--end::Input group-->
                        <!--begin::Button-->
                        <button type="button" class="btn btn-light-primary btn-sm mb-5" data-bs-toggle="modal" data-bs-target="#kt_modal_add_categorie">
                        <!--begin::Svg Icon | path: icons/duotune/arrows/arr087.svg-->
                        <span class="svg-icon svg-icon-2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect opacity="0.5" x="11" y="18" width="12" height="2" rx="1" transform="rotate(-90 11 18)" fill="currentColor" />
                                <rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor" />
                            </svg>
                        </span>
                        <!--end::Svg Icon-->Nouvelle categorie</button>
                        <!--end::Button-->
                        <div class="type">
                            {% if product.categorie is not null %}
                            <label class="required form-label">Type</label>
                            <select name="type" class="form-select mb-10" data-control="select2" data-hide-search="true" data-placeholder="Selectionner un type">
                                <option></option>
                                {% for type in types %}
                                    <option value="{{type.id}}" {% if product.type == type %}selected{% endif %}>{{type.libelle}}</option>
                                {% endfor %}
                            </select>
                            {% endif %}
                        </div>
                        <!--begin::Input group-->
                        <!--begin::Label-->
                        <label class="form-label d-block">Mots clés</label>
                        <!--end::Label-->
                        <!--begin::Input-->
                        <input id="kt_ecommerce_add_product_tags" 
                            name="tags" 
                            class="form-control mb-2" 
                            value="{% for tag in product.tags %}{{tag}}{% if not loop.last %}, {% endif %}{% endfor %}" 
                        />
                        <!--end::Input-->
                        <!--begin::Description-->
                        <div class="text-muted fs-7">Ajouter des mots clés au produit.</div>
                        <!--end::Description-->
                        <!--end::Input group-->
                    </div>
                    <!--end::Card body-->
                </div>
                <!--end::Category & tags-->
                <!--begin::Template settings-->
                <div class="card card-flush py-4">
                    <!--begin::Card header-->
                    <div class="card-header">
                        <!--begin::Card title-->
                        <div class="card-title">
                            <h2>Marque</h2>
                        </div>
                        <!--end::Card title-->
                    </div>
                    <!--end::Card header-->
                    <!--begin::Card body-->
                    <div class="card-body pt-0 fv-row">
                        <!--begin::Select store template-->
                        <label for="kt_ecommerce_add_product_store_template" class="required form-label">Selectionner la marque</label>
                        <!--end::Select store template-->
                        <!--begin::Select2-->
                        <select name="marque" class="form-select mb-2" data-control="select2" data-hide-search="true" data-placeholder="Selectionner une marque" id="kt_ecommerce_add_product_store_template">
                            <option></option>
                            {% for marque in marques %}
                                <option value="{{marque.id}}" {% if product.marque == marque %}selected{% endif %}>{{marque.libelle}}</option>
                            {% endfor %}
                        </select>
                        <!--end::Select2-->
                        <!--begin::Description-->
                        <div class="text-muted fs-7">Selectionner la marque ou le fournisseur du produit</div>
                        <!--end::Description-->
                    </div>
                    <!--end::Card body-->
                </div>
                <!--end::Template settings-->
            </div>
            <!--end::Aside column-->
            <!--begin::Main column-->
            <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
                <!--begin:::Tabs-->
                <ul class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-semibold mb-n2">
                    <!--begin:::Tab item-->
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4 active" data-bs-toggle="tab" href="#kt_ecommerce_add_product_general">Général</a>
                    </li>
                    <!--end:::Tab item-->
                    <!--begin:::Tab item-->
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4" data-bs-toggle="tab" href="#kt_ecommerce_add_product_advanced">Avancé</a>
                    </li>
                    <!--end:::Tab item-->
                </ul>
                <!--end:::Tabs-->
                <!--begin::Tab content-->
                <div class="tab-content">
                    <!--begin::Tab pane-->
                    <div class="tab-pane fade show active" id="kt_ecommerce_add_product_general" role="tab-panel">
                        <div class="d-flex flex-column gap-7 gap-lg-10">
                            <!--begin::General options-->
                            <div class="card card-flush py-4">
                                <!--begin::Card header-->
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Général</h2>
                                    </div>
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Input group-->
                                    <div class="mb-10 fv-row">
                                        <!--begin::Label-->
                                        <label class="required form-label">Nom du produit</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <input type="text" name="product_name" class="form-control mb-2" placeholder="Nom du produit" value="{{product.nom}}" />
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Un nom de produit est requis et recommandé pour être unique.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Input group-->
                                    <div>
                                        <!--begin::Label-->
                                        <label class="form-label">La description</label>
                                        <!--end::Label-->
                                        <!--begin::Editor-->
                                        <textarea name="description" class="d-none">{{product.description|raw}}</textarea>
                                        <div id="kt_ecommerce_add_product_description" class="min-h-200px mb-2">{{product.description|raw}}</div>
                                        <!--end::Editor-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Attribuez une description au produit pour une meilleure visibilité.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                </div>
                                <!--end::Card header-->
                            </div>
                            <!--end::General options-->
                            {% if product.sku is not null %}
                            <!--begin::Media-->
                            <div class="card card-flush py-4">
                                <!--begin::Card header-->
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Médias</h2>
                                    </div>
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Input group-->
                                    <div class="fv-row mb-2">
                                        <!--begin::Dropzone-->
                                        <div class="dropzone" id="kt_ecommerce_add_product_media">
                                            <!--begin::Message-->
                                            <div class="dz-message needsclick">
                                                <!--begin::Icon-->
                                                <i class="bi bi-file-earmark-arrow-up text-primary fs-3x"></i>
                                                <!--end::Icon-->
                                                <!--begin::Info-->
                                                <div class="ms-4">
                                                    <h3 class="fs-5 fw-bold text-gray-900 mb-1">Déposez les fichiers ici ou cliquez pour télécharger.</h3>
                                                    <span class="fs-7 fw-semibold text-gray-400">Téléchargez jusqu'à 10 fichiers</span>
                                                </div>
                                                <!--end::Info-->
                                            </div>
                                            {# for media in product.medias %}
                                            <div class="dz-preview dz-processing dz-success dz-complete dz-image-preview"> 
                                                <div class="dz-image">
                                                    <img data-dz-thumbnail="" alt="{{media.alt}}" src="{{asset('uploads/images/'~ media.tempFile)}}" height="120" width="120">
                                                </div> 
                                                <div class="dz-details"> 
                                                    <div class="dz-size">
                                                        <span data-dz-size=""><strong>25.7</strong> KB</span>
                                                    </div> 
                                                    <div class="dz-filename">
                                                        <span data-dz-name="">{{media.alt}}</span>
                                                    </div> 
                                                </div> 
                                                <div class="dz-progress"> 
                                                    <span class="dz-upload" data-dz-uploadprogress="" style="width: 100%;"></span> 
                                                </div> 
                                                <div class="dz-error-message">
                                                    <span data-dz-errormessage=""></span>
                                                </div> 
                                                <div class="dz-success-mark"> 
                                                    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <title>Check</title> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF"></path> </g> </svg> </div> <div class="dz-error-mark"> <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <title>Error</title> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475"> <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z"></path> </g> </g> </svg> 
                                                </div> 
                                                <a class="dz-remove" href="javascript:undefined;" data-dz-remove="">Supprimer</a>
                                            </div>
                                            {% endfor #}
                                        </div>
                                        <!--end::Dropzone-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Description-->
                                    <div class="text-muted fs-7">Définissez la galerie multimédia du produit.</div>
                                    <!--end::Description-->
                                </div>
                                <!--end::Card header-->
                            </div>
                            <!--end::Media-->
                            {% endif %}
                            <!--begin::Pricing-->
                            <div class="card card-flush py-4">
                                <!--begin::Card header-->
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Tarification</h2>
                                    </div>
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Input group-->
                                    <div class="mb-10 fv-row">
                                        <!--begin::Label-->
                                        <label class="required form-label">Points de base</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <input type="text" name="price" class="form-control mb-2" placeholder="Points du product" onkeypress="return event.charCode>=48 && event.charCode<=57" inputmode="numeric" value="{{product.points}}" />
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Fixez les points du produit.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Input group-->
                                    <div class="fv-row mb-10">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Type de remise 
                                        <i class="fas fa-exclamation-circle ms-2 fs-7" data-bs-toggle="tooltip" title="Selectionner un type de rémise qui sera appliqué à ce produit"></i></label>
                                        <!--End::Label-->
                                        <!--begin::Row-->
                                        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-1 row-cols-xl-3 g-9" data-kt-buttons="true" data-kt-buttons-target="[data-kt-button='true']">
                                            <!--begin::Col-->
                                            <div class="col">
                                                <!--begin::Option-->
                                                <label class="btn btn-outline btn-outline-dashed btn-active-light-primary active d-flex text-start p-6" data-kt-button="true">
                                                    <!--begin::Radio-->
                                                    <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                                                        <input class="form-check-input" type="radio" name="remise" value="Pas de rabais" {% if product.remise == "Pas de rabais" or product.remise is null %}checked="checked"{% endif %} />
                                                    </span>
                                                    <!--end::Radio-->
                                                    <!--begin::Info-->
                                                    <span class="ms-5">
                                                        <span class="fs-4 fw-bold text-gray-800 d-block">Pas de rabais</span>
                                                    </span>
                                                    <!--end::Info-->
                                                </label>
                                                <!--end::Option-->
                                            </div>
                                            <!--end::Col-->
                                            <!--begin::Col-->
                                            <div class="col">
                                                <!--begin::Option-->
                                                <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                                                    <!--begin::Radio-->
                                                    <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                                                        <input class="form-check-input" type="radio" name="remise" value="Pourcentage" {% if product.remise == "Pourcentage" %}checked="checked"{% endif %} />
                                                    </span>
                                                    <!--end::Radio-->
                                                    <!--begin::Info-->
                                                    <span class="ms-5">
                                                        <span class="fs-4 fw-bold text-gray-800 d-block">Pourcentage %</span>
                                                    </span>
                                                    <!--end::Info-->
                                                </label>
                                                <!--end::Option-->
                                            </div>
                                            <!--end::Col-->
                                            <!--begin::Col-->
                                            <div class="col">
                                                <!--begin::Option-->
                                                <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6" data-kt-button="true">
                                                    <!--begin::Radio-->
                                                    <span class="form-check form-check-custom form-check-solid form-check-sm align-items-start mt-1">
                                                        <input class="form-check-input" type="radio" name="remise" value="Points Fixe" {% if product.remise == "Points Fixe" %}checked="checked"{% endif %} />
                                                    </span>
                                                    <!--end::Radio-->
                                                    <!--begin::Info-->
                                                    <span class="ms-5">
                                                        <span class="fs-4 fw-bold text-gray-800 d-block">Points Fixe</span>
                                                    </span>
                                                    <!--end::Info-->
                                                </label>
                                                <!--end::Option-->
                                            </div>
                                            <!--end::Col-->
                                        </div>
                                        <!--end::Row-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Input group-->
                                    <div class="{% if product.remise != "Pourcentage" %}d-none {% endif %}mb-10 fv-row" id="kt_ecommerce_add_product_discount_percentage">
                                        <!--begin::Label-->
                                        <label class="form-label">Définir le pourcentage de remise</label>
                                        <!--end::Label-->
                                        <!--begin::Slider-->
                                        <div class="d-flex flex-column text-center mb-5">
                                            <div class="d-flex align-items-start justify-content-center mb-7">
                                                <span class="fw-bold fs-3x" id="kt_ecommerce_add_product_discount_label">0</span>
                                                <span class="fw-bold fs-4 mt-1 ms-2">%</span>
                                            </div>
                                            <input id="valeur_remise" type="hidden" name="valeur_remise" value="{{product.valeurRemise}}" />
                                            <div id="kt_ecommerce_add_product_discount_slider" class="noUi-sm"></div>
                                        </div>
                                        <!--end::Slider-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Définissez un pourcentage de remise à appliquer sur ce produit.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Input group-->
                                    <div class="{% if product.remise != "Points Fixe" %}d-none {% endif %}mb-10 fv-row" id="kt_ecommerce_add_product_discount_fixed">
                                        <!--begin::Label-->
                                        <label class="form-label">Points réduits fixe</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <input type="text" name="valeur_remise" class="form-control mb-2" placeholder="Points réduit" value="{{product.valeurRemise}}" />
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Définissez les points réduits du produit. Le produit sera réduit aux points fixes déterminés</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                </div>
                                <!--end::Card header-->
                            </div>
                            <!--end::Pricing-->
                        </div>
                    </div>
                    <!--end::Tab pane-->
                    <!--begin::Tab pane-->
                    <div class="tab-pane fade" id="kt_ecommerce_add_product_advanced" role="tab-panel">
                        <div class="d-flex flex-column gap-7 gap-lg-10">
                            <!--begin::Inventory-->
                            <div class="card card-flush py-4">
                                <!--begin::Card header-->
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Inventaire</h2>
                                    </div>
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Input group-->
                                    <div class="mb-10 fv-row">
                                        <!--begin::Label-->
                                        <label class="required form-label">SKU</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <div class="input-group">
                                            <input type="text" name="sku" class="form-control" placeholder="Numéro SKU" value="{{product.sku}}" />
                                            <button type="button" class="input-group-text" id="basic-addon2" onclick="$('input[name=sku]').val(Math.floor(Math.random() * 99999999) + 1);">Cliquer pour générer</button>
                                        </div>
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Saisissez le SKU du produit.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Input group-->
                                    <div class="mb-10 fv-row">
                                        <!--begin::Label-->
                                        <label class="required form-label">Quantité</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <div class="d-flex gap-3">
                                            <input type="number" name="quantite" class="form-control mb-2" placeholder="Disponible" value="{{product.quantite}}" />
                                            <input type="number" name="stock" class="form-control mb-2" placeholder="En stock" value="{{product.stock}}" />
                                        </div>
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Entrez la quantité de produit.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Input group-->
                                    <div class="fv-row">
                                        <!--begin::Label-->
                                        <label class="form-label">Autoriser les commandes en rupture</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <div class="form-check form-check-custom form-check-solid mb-2">
                                            <input id="backorders" name="backorders" class="form-check-input" type="checkbox" value="1" {% if product.backorders %}checked{% endif %} />
                                            <label class="form-check-label" for="backorders">Oui</label>
                                        </div>
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Permettre aux clients de commander des produits en rupture de stock.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                </div>
                                <!--end::Card header-->
                            </div>
                            <!--end::Inventory-->
                            <!--begin::Variations-->
                            <div class="card card-flush py-4">
                                <!--begin::Card header-->
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Variantes</h2>
                                    </div>
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Input group-->
                                    <div class="" data-kt-ecommerce-catalog-add-product="auto-options">
                                        <!--begin::Label-->
                                        <label class="form-label">Ajouter des variantes de produit</label>
                                        <!--end::Label-->
                                        <!--begin::Repeater-->
                                        <div id="kt_ecommerce_add_product_options">
                                            <!--begin::Form group-->
                                            <div class="form-group">
                                                <div data-repeater-list="variantes" class="d-flex flex-column gap-3">
                                                    <div data-repeater-item="" class="form-group d-flex flex-wrap align-items-center gap-5">
                                                        <!--begin::Select2-->
                                                        <div class="w-100 w-md-200px">
                                                            <select class="form-select" name="option" data-placeholder="Selectionner une variante" data-kt-ecommerce-catalog-add-product="product_option">
                                                                <option></option>
                                                                <option value="couleur">Couleur</option>
                                                                <option value="taille">Taille</option>
                                                                <option value="matériel">Matériel</option>
                                                                <option value="style">Style</option>
                                                            </select>
                                                        </div>
                                                        <!--end::Select2-->
                                                        <!--begin::Input-->
                                                        <input type="text" class="form-control mw-100 w-200px" name="value" placeholder="Variante" />
                                                        <!--end::Input-->
                                                        <button type="button" data-repeater-delete="" class="btn btn-sm btn-icon btn-light-danger">
                                                            <!--begin::Svg Icon | path: icons/duotune/arrows/arr088.svg-->
                                                            <span class="svg-icon svg-icon-1">
                                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                    <rect opacity="0.5" x="7.05025" y="15.5356" width="12" height="2" rx="1" transform="rotate(-45 7.05025 15.5356)" fill="currentColor" />
                                                                    <rect x="8.46447" y="7.05029" width="12" height="2" rx="1" transform="rotate(45 8.46447 7.05029)" fill="currentColor" />
                                                                </svg>
                                                            </span>
                                                            <!--end::Svg Icon-->
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--end::Form group-->
                                            <!--begin::Form group-->
                                            <div class="form-group mt-5">
                                                <button type="button" data-repeater-create="" class="btn btn-sm btn-light-primary">
                                                <!--begin::Svg Icon | path: icons/duotune/arrows/arr087.svg-->
                                                <span class="svg-icon svg-icon-2">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <rect opacity="0.5" x="11" y="18" width="12" height="2" rx="1" transform="rotate(-90 11 18)" fill="currentColor" />
                                                        <rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor" />
                                                    </svg>
                                                </span>
                                                <!--end::Svg Icon-->Ajouter une autre variante</button>
                                            </div>
                                            <!--end::Form group-->
                                        </div>
                                        <!--end::Repeater-->
                                    </div>
                                    <!--end::Input group-->
                                </div>
                                <!--end::Card header-->
                            </div>
                            <!--end::Variations-->
                            <!--begin::Shipping-->
                            <div class="card card-flush py-4">
                                <!--begin::Card header-->
                                <div class="card-header">
                                    <div class="card-title">
                                        <h2>Expédition</h2>
                                    </div>
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body pt-0">
                                    <!--begin::Input group-->
                                    <div class="fv-row">
                                        <!--begin::Input-->
                                        <div class="form-check form-check-custom form-check-solid mb-2">
                                            <input class="form-check-input" type="checkbox" name="poidsPhysique" id="kt_ecommerce_add_product_shipping_checkbox" value="1" {% if product.poidsPhysique %}checked{% endif %} />
                                            <label class="form-check-label" for="kt_ecommerce_add_product_shipping_checkbox">Ceci est un produit physique</label>
                                        </div>
                                        <!--end::Input-->
                                        <!--begin::Description-->
                                        <div class="text-muted fs-7">Définissez si le produit est un article physique ou numérique. Les produits physiques peuvent nécessiter une expédition.</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Input group-->
                                    <!--begin::Shipping form-->
                                    <div id="kt_ecommerce_add_product_shipping" class="{% if not product.poidsPhysique %}d-none {% endif %}mt-10">
                                        <!--begin::Input group-->
                                        <div class="mb-10 fv-row">
                                            <!--begin::Label-->
                                            <label class="form-label">Poids</label>
                                            <!--end::Label-->
                                            <!--begin::Editor-->
                                            <input type="text" name="weight" class="form-control mb-2" placeholder="Poids du produit" value="{{product.poids}}" />
                                            <!--end::Editor-->
                                            <!--begin::Description-->
                                            <div class="text-muted fs-7">Définissez un poids de produit en kilogrammes (kg).</div>
                                            <!--end::Description-->
                                        </div>
                                        <!--end::Input group-->
                                        <!--begin::Input group-->
                                        <div class="fv-row">
                                            <!--begin::Label-->
                                            <label class="form-label">Dimension</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <div class="d-flex flex-wrap flex-sm-nowrap gap-3">
                                                <input type="number" name="width" class="form-control mb-2" placeholder="Largeur (w)" value="{{product.largeur}}" />
                                                <input type="number" name="height" class="form-control mb-2" placeholder="Hauteur (h)" value="{{product.hauteur}}" />
                                                <input type="number" name="length" class="form-control mb-2" placeholder="Longueur (l)" value="{{product.longueur}}" />
                                            </div>
                                            <!--end::Input-->
                                            <!--begin::Description-->
                                            <div class="text-muted fs-7">Entrez les dimensions du produit en centimètres (cm).</div>
                                            <!--end::Description-->
                                        </div>
                                        <!--end::Input group-->
                                    </div>
                                    <!--end::Shipping form-->
                                </div>
                                <!--end::Card header-->
                            </div>
                            <!--end::Shipping-->
                        </div>
                    </div>
                    <!--end::Tab pane-->
                </div>
                <!--end::Tab content-->
                <div class="d-flex justify-content-end">
                    <!--begin::Button-->
                    <a href="{{path('products.list')}}" id="kt_ecommerce_add_product_cancel" class="btn btn-light me-5">Cancel</a>
                    <!--end::Button-->
                    <!--begin::Button-->
                    <button type="submit" id="kt_ecommerce_add_product_submit" class="btn btn-primary">
                        <span class="indicator-label">Sauvegarder</span>
                        <span class="indicator-progress">Veuillez patienter... 
                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                    <!--end::Button-->
                </div>
            </div>
            <!--end::Main column-->
        </form>
        <!--end::Form-->

        <!--begin::Modals-->
        <!--begin::Modal Categorie-->
        <div class="modal fade" tabindex="-1" id="kt_modal_add_categorie">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form class="form" id="kt_form_add_categorie">
                        <div class="modal-header">
                            <h5 class="modal-title">Nouvelle Categorie</h5>
                            <!--begin::Close-->
                            <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                                <span class="svg-icon svg-icon-2x"></span>
                            </div>
                            <!--end::Close-->
                        </div>

                        <div class="modal-body">
                            <div class="fv-row mb-7 fv-plugins-icon-container">
                                <label class="required form-label">Catégories</label>
                                <select name="parent" class="form-select mb-2" data-control="select2" data-hide-search="true" data-placeholder="Selectionner une catégorie" required>
                                    <option></option>
                                    {% for categ in categories %}
                                        <option value="{{categ.id}}" {% if product.categorie == categ %}selected{% endif %}>{{categ.libelle}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="fv-row mb-7 fv-plugins-icon-container">
                                <label class="required fw-bold fs-6 mb-2">Sous-categorie</label>
                                <input type="hidden" name="type" value="Sous-Categories">
                                <input type="text" name="libelle" class="form-control form-control-solid mb-3 mb-lg-0" placeholder="Libellé de la sous-catégorie" required>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="reset" class="btn btn-light" data-bs-dismiss="modal">Fermer</button>
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--end::Modal Categorie-->
    </div>
    <!--end::Container-->
</div>
{% endblock %}

{% block javascripts %}
<!--begin::Page Vendors Javascript(used by this page)-->
<script src="{{asset('assets/plugins/custom/datatables/datatables.bundle.js')}}"></script>
<script src="{{asset('assets/plugins/custom/formrepeater/formrepeater.bundle.js')}}"></script>
<!--end::Page Vendors Javascript-->
<!--begin::Page Custom Javascript(used by this page)-->
<script src="{{asset('assets/js/custom/apps/ecommerce/catalog/save-product.js')}}"></script>
<script src="{{asset('assets/js/widgets.bundle.js')}}"></script>
<script src="{{asset('assets/js/custom/widgets.js')}}"></script>
<!--end::Page Custom Javascript-->
<script type="text/javascript">
$('#kt_form_add_categorie').submit(function(e){
    e.preventDefault();
    var self = $(this);
    var formData = new FormData(this);
    $.ajax({
        url: "{{path('param.add')}}",
        data: formData,
        dataType: "html",
        processData: false,
        contentType: false,
        type: "POST",
        success: function(response) {
            $data = JSON.parse(response);
            $content = '';
            $.each($data, function(index, categ){
                $content += '<optgroup label="'+categ.libelle+'">';
                for (var i=0; i<categ.children.length; i++) $content += '<option value="'+categ.children[i].id+'">'+categ.children[i].libelle+'</option>';
                $content += '</optgroup>';
            });

            $('select[name=categorie]').html($content).select2({
                minimumResultsForSearch: -1
            });
            self.find('[data-bs-dismiss="modal"]').click();
        }
    });
});
$('select[name=categorie]').change(function() {
    var categ = $(this).val();
    var content = '<label class="required form-label">Type</label>'+
                    '<select name="type" class="form-select mb-10" data-control="select2" data-hide-search="true" data-placeholder="Selectionner un type">'+
                        '<option></option>';
    {% for type in types %}
        if (categ == "{{type.parent.id}}") content += '<option value="{{type.id}}">{{type.libelle}}</option>';
    {% endfor %}
    content += '</select>';
    
    console.log(content);
    $('.type').html(content).find('select').select2({
        minimumResultsForSearch: -1
    });
});
// Init noUIslider
const initSlider = () => {
    var slider = document.querySelector("#kt_ecommerce_add_product_discount_slider");
    var value = document.querySelector("#kt_ecommerce_add_product_discount_label");
    var input = document.querySelector('#valeur_remise');

    noUiSlider.create(slider, {
        start: [{{product.valeurRemise|default(10)}}],
        connect: true,
        range: {
            "min": 1,
            "max": 100
        }
    });

    slider.noUiSlider.on("update", function (values, handle) {
        value.innerHTML = Math.round(values[handle]);
        input.value = Math.round(values[handle]);
        if (handle) {
            value.innerHTML = Math.round(values[handle]);
            input.value = Math.round(values[handle]);
        }
    });
}
// Init DropzoneJS --- more info:
{% if product.sku is not null %}
initDropzone();
function initDropzone() {
    var file_up_names = [];
    var myDropzone = new Dropzone("#kt_ecommerce_add_product_media", {
        url: "{{path('products.medias', {id: product.id})}}", // Set the url for your upload script location
        paramName: "media", // The name that will be used to transfer the file
        maxFiles: 10,
        maxFilesize: 10, // MB
        addRemoveLinks: true,
        accept: function (file, done) {
            if (file.name == "wow.jpg") {
                done("Naha, you don't.");
            } else {
                done();
                file_up_names.push(file.name);
            }
        },
        removedfile: function(file) {
            x = confirm('Êtes-vous sûr de vouloir supprimer ?');
            if (!x)  return false;
            for (var i=0;i<file_up_names.length;++i) {
                if (file_up_names[i]==file.name) {
                    $.post("{{path('products.medias', {id: product.id})}}",
                    {file_name:file_up_names[i]},
                    function(data,status){
                        file.previewElement.remove();
                    });
                }
            }
        },
        init: function () {
            const data = [];
            {% for media in product.medias %}
                data.push({
                    'name': "{{media.alt}}",
                    'size': "{{media.size}}",
                    'url': "{{asset('uploads/images/'~ media.tempFile)}}"
                });
            {% endfor %}
            let oldDropzone = this;
            $.each(data, function (key, value) {
                const mockFile = {name: value.name, size: value.size};
                oldDropzone.files[key] = value.name;
                oldDropzone.options.addedfile.call(oldDropzone, mockFile);
                oldDropzone.options.thumbnail.call(oldDropzone, mockFile, value.url);
                // mockFile.previewElement.classList.add('dz-success');
                mockFile.previewElement.classList.add('dz-complete');
            });
        }
    });
}
{% endif %}
</script>
{% endblock %}